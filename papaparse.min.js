<script>
    let rawData = [];
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ99AnzKxfM4RiLan520o2whUadT-vxlbgBCXbSPy9AeW110OHI3SezC1AVxHXwnG681jWB6LVv9p2c/pub?gid=902005521&single=true&output=csv';

    Papa.parse(csvUrl, {
      download: true,
      header: true,
      complete: function(results) {
        rawData = results.data;
        renderSummary();
        renderTable(rawData.slice(0, 10));
      }
    });

    function renderTable(data) {
      const tbody = document.getElementById('dataTable');
      tbody.innerHTML = '';
      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${row.NIP}</td><td>${row.NAMA}</td><td>${row.UNIT}</td><td>${row.JABATAN}</td><td>${row.SPK}</td><td>${row['LOKASI ABSEN']}</td><td>${row.KETERANGAN}</td>`;
        tbody.appendChild(tr);
      });
    }

    function renderSummary() {
      let kalselBelum = 0, kalselSudah = 0, kaltengBelum = 0, kaltengSudah = 0;
      rawData.forEach(row => {
        if (row.UNIT === 'KALSEL') {
          if (row.KETERANGAN === 'BELUM ABSEN') kalselBelum++;
          if (row.KETERANGAN === 'SUDAH ABSEN') kalselSudah++;
        }
        if (row.UNIT === 'KALTENG') {
          if (row.KETERANGAN === 'BELUM ABSEN') kaltengBelum++;
          if (row.KETERANGAN === 'SUDAH ABSEN') kaltengSudah++;
        }
      });
      document.getElementById('kalselBelum').innerText = kalselBelum;
      document.getElementById('kalselSudah').innerText = kalselSudah;
      document.getElementById('kaltengBelum').innerText = kaltengBelum;
      document.getElementById('kaltengSudah').innerText = kaltengSudah;
    }

    function filterData() {
      const type = document.getElementById('filterType').value;
      const limit = parseInt(document.getElementById('dataLimit').value);
      renderTable(rawData.slice(0, limit));
    }

    function downloadCSV() {
      const link = document.createElement('a');
      link.href = csvUrl;
      link.download = 'MonitoringKSO.csv';
      link.click();
    }
  </script>
</body>
</html>
